{"version":3,"sources":["store/Store.ts","App.tsx","index.tsx"],"names":["currentStore","App","observer","props","useState","login","setLogin","pwd","setPwd","todo","setTodo","store","user","alias","error","style","backgroundColor","_","chain","entries","todos","orderBy","x","map","onClick","deleteTodo","value","onChange","e","target","addTodo","type","createUser","logout","configure","enforceActions","useProxies","gun","broken","onConnect","console","log","Gun","peers","onDisconnect","uuid","uuidv4","on","onAuth","recall","sessionStorage","window","mapPropertiesToGun","MyStore","makeAutoObservable","this","get","say","id","omit","off","is","setError","s","isLoggedIn","uid","put","text","created","Date","toISOString","self","setTimeout","password","length","create","err","auth","leave","cleanData","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.c06b4446.chunk.js","sourcesContent":["import { makeAutoObservable, configure } from \"mobx\";\n// @ts-ignore\nimport { v4 as uuidv4 } from \"uuid\";\n\n// eslint-global Gun\n\nconfigure({\n  enforceActions: \"never\",\n  useProxies: \"ifavailable\",\n});\n\n// GUN\nvar currentStore: Store;\nvar broken = true;\nvar gun: any;\n\nfunction onConnect() {\n  if (broken) {\n    console.log(\"(re)creating Gun connection\");\n    broken = false;\n    // @ts-ignore\n    gun = Gun({\n      peers: [\"http://81.2.251.53:8080/gun\"],\n      onConnect: onConnect,\n      onDisconnect: onDisconnect,\n      uuid: uuidv4,\n    });\n\n    // @ts-ignore\n    gun.on(\"auth\", onAuth);\n    // @ts-ignore\n    gun.user().recall({ sessionStorage: true });\n    // @ts-ignore\n    window.gun = gun;\n  }\n}\n\nfunction onDisconnect() {\n  broken = true;\n}\n\nfunction onAuth() {\n  currentStore.mapPropertiesToGun();\n}\n\nclass Store {\n  user = { alias: \"nepřihlášen\" };\n  error = \"\";\n  todos = {};\n\n  constructor() {\n    makeAutoObservable(this);\n    // @ts-ignore\n    window.store = this;\n    currentStore = this;\n    onConnect();\n  }\n\n  mapPropertiesToGun() {\n    console.log(\"map props to gun\");\n    this.user = { alias: \"přihlášen\" };\n    // @ts-ignore\n    gun\n      .user()\n      .get(\"todos\")\n      .map()\n      .on((say: any, id: string) => {\n        if (say) {\n          // @ts-ignore\n          this.todos = { ...this.todos, [id]: say };\n        } else {\n          // @ts-ignore\n          this.todos = _.omit(this.todos, [id]);\n        }\n      });\n  }\n\n  cleanData() {\n    // @ts-ignore\n    gun.user().get(\"todos\").map().off();\n    this.todos = {};\n  }\n\n  isLoggedIn() {\n    // @ts-ignore\n    if (!gun.user().is) {\n      this.setError(\"Nepřihlášený uživatel\");\n      return false;\n    } else {\n      this.error = \"\";\n      return true;\n    }\n  }\n\n  addTodo(s: string) {\n    if (!this.isLoggedIn()) {\n      return;\n    }\n    const uid = uuidv4();\n    // @ts-ignore\n    gun\n      .user()\n      .get(\"todos\")\n      .get(uid)\n      .put({ uid: uid, text: s, created: new Date().toISOString() });\n  }\n\n  deleteTodo(id: string) {\n    if (!this.isLoggedIn()) {\n      return;\n    }\n    // @ts-ignore\n    gun.user().get(\"todos\").get(id).put(null);\n  }\n\n  setError(s: string) {\n    this.error = s;\n    // @ts-ignore\n    var self = this;\n    setTimeout(function () {\n      self.error = \"\";\n    }, 3000);\n  }\n\n  createUser(login: string, password: string) {\n    if (!login) {\n      this.setError(\"Nezadali jste přihlašovací jméno\");\n      return;\n    }\n    if (!password) {\n      this.setError(\"Nezadali jste heslo\");\n      return;\n    }\n    if (password.length < 5) {\n      this.setError(\"Heslo musí být aspoň 5 znaků dlouhé\");\n      return;\n    }\n    // @ts-ignore\n    gun.user().create(login, password, (x) => {\n      console.log(\"xxx\", x);\n      if (x.err) {\n        this.setError(\"Uživatel již existuje\");\n      }\n    });\n  }\n\n  login(login: string, password: string) {\n    // @ts-ignore\n    gun.user().auth(login, password, (x) => {\n      if (x.err) {\n        this.setError(\"Neplatné přihlášení\");\n      }\n    });\n  }\n\n  logout() {\n    // @ts-ignore\n    gun.user().leave();\n    this.user = { alias: \"nepřihlášen\" };\n    this.cleanData();\n  }\n}\n\nexport { Store };\n","import React, { useState } from \"react\";\nimport { observer } from \"mobx-react-lite\";\nimport { entries } from \"mobx\";\nimport { Store } from \"./store\";\n// @ts-ignore\nimport _ from \"lodash\";\n\nconst App = observer((props: { store: Store }) => {\n  const [login, setLogin] = useState(\"\");\n  const [pwd, setPwd] = useState(\"\");\n  const [todo, setTodo] = useState(\"\");\n\n  return (\n    <>\n      <h1>TODO</h1>\n      Uživatel {props.store.user.alias}\n      <br></br>\n      {props.store.error && (\n        <div style={{ backgroundColor: \"pink\" }}>{props.store.error}</div>\n      )}\n      <br></br>\n      <pre>\n        {_.chain(entries(props.store.todos))\n          // @ts-ignore\n          .orderBy((x) => x[1][\"created\"])\n          // @ts-ignore\n          .map((x) => {\n            return (\n              <div key={x[0]}>\n                id: {x[1][\"uid\"]} / text: {x[1][\"text\"]} / created:{\" \"}\n                {x[1][\"created\"]}\n                &nbsp;\n                <button\n                  onClick={() => {\n                    props.store.deleteTodo(x[0]);\n                  }}\n                >\n                  Smazat\n                </button>\n              </div>\n            );\n          })\n          .value()}\n      </pre>\n      New TODO:{\" \"}\n      <input\n        value={todo}\n        onChange={(e) => {\n          setTodo(e.target.value);\n        }}\n      ></input>\n      <button\n        onClick={() => {\n          props.store.addTodo(todo);\n          setTodo(\"\");\n        }}\n      >\n        Add TODO\n      </button>\n      <hr></hr>\n      Login:{\" \"}\n      <input\n        value={login}\n        onChange={(e) => {\n          setLogin(e.target.value);\n        }}\n      />\n      <br></br>\n      Password:{\" \"}\n      <input\n        value={pwd}\n        type=\"password\"\n        onChange={(e) => {\n          setPwd(e.target.value);\n        }}\n      />\n      <br></br>\n      <button\n        onClick={() => {\n          // @ts-ignore\n          props.store.login(login, pwd);\n        }}\n      >\n        Sign In\n      </button>\n      <button\n        onClick={() => {\n          // @ts-ignore\n          props.store.createUser(login, pwd);\n        }}\n      >\n        Sign Up\n      </button>\n      <br></br>\n      <button\n        onClick={() => {\n          // @ts-ignore\n          props.store.logout();\n        }}\n      >\n        Logout\n      </button>\n    </>\n  );\n});\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport App from \"./App\";\nimport { Store } from \"./store\";\n\nconst MyStore = new Store();\n\nReactDOM.render(\n  <React.StrictMode>\n    <App store={MyStore} />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}