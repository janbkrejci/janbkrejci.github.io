{"version":3,"sources":["store/Store.ts","App.tsx","index.tsx"],"names":["currentStore","App","observer","props","useState","login","setLogin","pwd","setPwd","todo","setTodo","style","float","store","userAlias","error","backgroundColor","color","marginLeft","marginRight","width","border","padding","_","chain","entries","todos","orderBy","x","map","margin","marginBottom","onClick","val","prompt","changeTodo","title","cursor","e","preventDefault","stopPropagation","deleteTodo","value","placeholder","autoFocus","onKeyPress","key","addTodo","onChange","target","type","createUser","logout","configure","enforceActions","useProxies","gun","broken","onConnect","console","log","Gun","peers","onDisconnect","uuid","uuidv4","on","onAuth","user","recall","sessionStorage","window","params","mapPropertiesToGun","ANONYMOUS","pub","alias","MyStore","makeAutoObservable","this","is","self","get","say","id","omit","off","setError","s","isLoggedIn","uid","put","text","created","Date","toISOString","once","updated","setTimeout","password","length","create","err","auth","cleanData","leave","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.44fa59b4.chunk.js","sourcesContent":["import { makeAutoObservable, configure } from \"mobx\";\n// @ts-ignore\nimport { v4 as uuidv4 } from \"uuid\";\n\n// eslint-global Gun\n\nconfigure({\n  enforceActions: \"never\",\n  useProxies: \"ifavailable\",\n});\n\n// GUN\nvar currentStore: Store;\nvar broken = true;\nvar gun: any;\n\nfunction onConnect() {\n  if (broken) {\n    console.log(\"(re)creating Gun connection\");\n    broken = false;\n    // @ts-ignore\n    gun = Gun({\n      peers: [\"https://ts.nas-system.cz/gun\"],\n      onConnect: onConnect,\n      onDisconnect: onDisconnect,\n      uuid: uuidv4,\n    });\n\n    // @ts-ignore\n    gun.on(\"auth\", onAuth);\n    // @ts-ignore\n    gun.user().recall({ sessionStorage: true });\n    // @ts-ignore\n    window.gun = gun;\n  }\n}\n\nfunction onDisconnect() {\n  broken = true;\n}\n\nfunction onAuth(params: any) {\n  currentStore.mapPropertiesToGun();\n}\n\nconst ANONYMOUS = { pub: null, alias: \"Host\" };\n\nclass Store {\n  user = ANONYMOUS;\n  error = \"\";\n  todos = {};\n\n  constructor() {\n    makeAutoObservable(this);\n    // @ts-ignore\n    window.store = this;\n    currentStore = this;\n    onConnect();\n  }\n\n  get userAlias(): string {\n    return this.user.alias;\n  }\n\n  mapPropertiesToGun() {\n    console.log(\"map props to gun\");\n    // @ts-ignore\n    if (gun.user().is) {\n      const self = this;\n      gun.user(gun.user().is.pub).on(function (x: any) {\n        // ...or once?\n        // @ts-ignore\n        //self.user = { pub: self.user.pub, alias: x.alias };\n        self.user.alias = x.alias;\n      });\n    }\n    // @ts-ignore\n    gun\n      .user()\n      .get(\"todos\")\n      .map()\n      .on((say: any, id: string) => {\n        if (say) {\n          // @ts-ignore\n          this.todos = { ...this.todos, [id]: say };\n        } else {\n          // @ts-ignore\n          this.todos = _.omit(this.todos, [id]);\n        }\n      });\n  }\n\n  cleanData() {\n    gun.user(this.user.pub).off();\n    gun.user().get(\"todos\").map().off();\n    this.todos = {};\n  }\n\n  isLoggedIn() {\n    // @ts-ignore\n    if (!gun.user().is) {\n      this.setError(\"Nep≈ôihl√°≈°en√Ω u≈æivatel\");\n      return false;\n    } else {\n      this.error = \"\";\n      return true;\n    }\n  }\n\n  addTodo(s: string) {\n    if (!this.isLoggedIn()) {\n      return;\n    }\n    const uid = uuidv4();\n    // @ts-ignore\n    gun\n      .user()\n      .get(\"todos\")\n      .get(uid)\n      .put({ uid: uid, text: s, created: new Date().toISOString() });\n  }\n\n  changeTodo(id: string, val: string) {\n    gun\n      .user()\n      .get(\"todos\")\n      .get(id)\n      .once(function (x: any) {\n        gun.user().get(\"todos\").get(id).put({\n          uid: id,\n          text: val,\n          created: x.created,\n          updated: new Date().toISOString(),\n        });\n      });\n  }\n\n  deleteTodo(id: string) {\n    if (!this.isLoggedIn()) {\n      return;\n    }\n    // @ts-ignore\n    gun.user().get(\"todos\").get(id).put(null);\n  }\n\n  setError(s: string) {\n    this.error = s;\n    // @ts-ignore\n    var self = this;\n    setTimeout(function () {\n      self.error = \"\";\n    }, 3000);\n  }\n\n  createUser(login: string, password: string) {\n    if (!login) {\n      this.setError(\"Nezadali jste p≈ôihla≈°ovac√≠ jm√©no\");\n      return;\n    }\n    if (!password) {\n      this.setError(\"Nezadali jste heslo\");\n      return;\n    }\n    if (password.length < 5) {\n      this.setError(\"Heslo mus√≠ b√Ωt aspo≈à 5 znak≈Ø dlouh√©\");\n      return;\n    }\n    // @ts-ignore\n    gun.user().create(login, password, (x) => {\n      console.log(\"xxx\", x);\n      if (x.err) {\n        this.setError(\"U≈æivatel ji≈æ existuje\");\n      }\n    });\n  }\n\n  login(login: string, password: string) {\n    // @ts-ignore\n    gun.user().auth(login, password, (x) => {\n      if (x.err) {\n        this.setError(\"Neplatn√© p≈ôihl√°≈°en√≠\");\n      }\n    });\n  }\n\n  logout() {\n    // @ts-ignore\n    this.cleanData();\n    this.user = ANONYMOUS;\n    gun.user().leave();\n  }\n}\n\nexport { Store };\n","import React, { useState } from \"react\";\nimport { observer } from \"mobx-react-lite\";\nimport { entries } from \"mobx\";\nimport { Store } from \"./store\";\n// @ts-ignore\nimport _ from \"lodash\";\n\nconst App = observer((props: { store: Store }) => {\n  const [login, setLogin] = useState(\"\");\n  const [pwd, setPwd] = useState(\"\");\n  const [todo, setTodo] = useState(\"\");\n\n  return (\n    <>\n      <div style={{ float: \"right\" }}>üë§ {props.store.userAlias}</div>\n      <br></br>\n      {props.store.error && (\n        <div\n          style={{\n            backgroundColor: \"#ffdddd\",\n            color: \"red\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            width: \"50%\",\n            border: \"solid 1px red\",\n            padding: \"1em\",\n          }}\n        >\n          {props.store.error}\n        </div>\n      )}\n      <br></br>\n      <pre>\n        {_.chain(entries(props.store.todos))\n          // @ts-ignore\n          .orderBy((x) => x[1][\"created\"])\n          // @ts-ignore\n          .map((x) => {\n            return (\n              <div\n                key={x[0]}\n                style={{\n                  width: \"50%\",\n                  backgroundColor: \"seashell\",\n                  margin: \"auto\",\n                  marginBottom: \"0.5em\",\n                  padding: \"1em\",\n                }}\n                onClick={() => {\n                  let val = prompt(\"Upravit:\", x[1][\"text\"]);\n                  if (val) {\n                    props.store.changeTodo(x[1][\"uid\"], val);\n                  }\n                }}\n              >\n                {x[1][\"text\"]}\n                &nbsp;\n                <span\n                  title=\"Smazat z√°znam\"\n                  style={{\n                    float: \"right\",\n                    cursor: \"pointer\",\n                  }}\n                  onClick={(e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    props.store.deleteTodo(x[0]);\n                  }}\n                >\n                  &times;\n                </span>\n              </div>\n            );\n          })\n          .value()}\n      </pre>\n      +{\" \"}\n      <input\n        value={todo}\n        placeholder=\"Zadej text a stiskni Enter\"\n        autoFocus\n        onKeyPress={(e) => {\n          if (e.key === \"Enter\") {\n            props.store.addTodo(todo);\n            setTodo(\"\");\n          }\n        }}\n        onChange={(e) => {\n          setTodo(e.target.value);\n        }}\n      ></input>\n      <hr></hr>\n      üë§{\" \"}\n      <input\n        value={login}\n        onChange={(e) => {\n          setLogin(e.target.value);\n        }}\n      />\n      <br></br>\n      üîë{\" \"}\n      <input\n        value={pwd}\n        type=\"password\"\n        onChange={(e) => {\n          setPwd(e.target.value);\n        }}\n      />\n      <br></br>\n      <button\n        onClick={() => {\n          // @ts-ignore\n          props.store.login(login, pwd);\n        }}\n      >\n        P≈ôihl√°sit\n      </button>\n      <button\n        onClick={() => {\n          // @ts-ignore\n          props.store.createUser(login, pwd);\n        }}\n      >\n        Registrovat\n      </button>\n      <br></br>\n      <button\n        onClick={() => {\n          // @ts-ignore\n          props.store.logout();\n        }}\n      >\n        Odhl√°sit\n      </button>\n    </>\n  );\n});\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport App from \"./App\";\nimport { Store } from \"./store\";\n\nconst MyStore = new Store();\n\nReactDOM.render(\n  <React.StrictMode>\n    <App store={MyStore} />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}